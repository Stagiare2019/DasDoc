-- Doctrine Migration File Generated on 2019-07-12 14:05:27

-- Version 20190704103231
CREATE SEQUENCE acte_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE action_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE etat_acte_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE famille_matiere_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE matiere_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE motcle_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE nature_acte_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE piece_jointe_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE service_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE type_action_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE SEQUENCE utilisateur_id_seq INCREMENT BY 1 MINVALUE 1 START 1;
CREATE TABLE acte (id INT NOT NULL, fk_etat_id INT NOT NULL, fk_nature_id INT NOT NULL, fk_matiere_id INT NOT NULL, fk_service_id INT DEFAULT NULL, nom_pdf VARCHAR(255) NOT NULL, numero VARCHAR(63) NOT NULL, objet VARCHAR(255) NOT NULL, date_decision DATE NOT NULL, date_effectivite_debut DATE DEFAULT NULL, date_effectivite_fin DATE DEFAULT NULL, description TEXT DEFAULT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_9EC41326BC3AFBDF ON acte (nom_pdf);
CREATE UNIQUE INDEX UNIQ_9EC41326F55AE19E ON acte (numero);
CREATE INDEX IDX_9EC41326FD71BBD3 ON acte (fk_etat_id);
CREATE INDEX IDX_9EC413265A92F9DB ON acte (fk_nature_id);
CREATE INDEX IDX_9EC4132640218CB ON acte (fk_matiere_id);
CREATE INDEX IDX_9EC413261D326375 ON acte (fk_service_id);
CREATE TABLE action (id INT NOT NULL, fk_type_id INT NOT NULL, fk_acte_id INT DEFAULT NULL, fk_utilisateur_id INT NOT NULL, date TIMESTAMP(0) WITHOUT TIME ZONE NOT NULL, PRIMARY KEY(id));
CREATE INDEX IDX_47CC8C923563B1BF ON action (fk_type_id);
CREATE INDEX IDX_47CC8C92574885EB ON action (fk_acte_id);
CREATE INDEX IDX_47CC8C928E8608A6 ON action (fk_utilisateur_id);
CREATE TABLE etat_acte (id INT NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_6056D389A4D60759 ON etat_acte (libelle);
CREATE TABLE famille_matiere (id INT NOT NULL, code VARCHAR(8) NOT NULL, nom VARCHAR(120) NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_5C7E5DA477153098 ON famille_matiere (code);
CREATE UNIQUE INDEX UNIQ_5C7E5DA46C6E55B5 ON famille_matiere (nom);
CREATE UNIQUE INDEX UNIQ_5C7E5DA4A4D60759 ON famille_matiere (libelle);
CREATE TABLE matiere (id INT NOT NULL, fk_famille_id INT NOT NULL, code VARCHAR(8) NOT NULL, nom VARCHAR(120) NOT NULL, libelle VARCHAR(127) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_9014574A77153098 ON matiere (code);
CREATE UNIQUE INDEX UNIQ_9014574A6C6E55B5 ON matiere (nom);
CREATE UNIQUE INDEX UNIQ_9014574AA4D60759 ON matiere (libelle);
CREATE INDEX IDX_9014574A67C9B117 ON matiere (fk_famille_id);
CREATE TABLE motcle (id INT NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_4496AE75A4D60759 ON motcle (libelle);
CREATE TABLE motcle_acte (motcle_id INT NOT NULL, acte_id INT NOT NULL, PRIMARY KEY(motcle_id, acte_id));
CREATE INDEX IDX_32EC2CF71D93C8D9 ON motcle_acte (motcle_id);
CREATE INDEX IDX_32EC2CF7A767B8C7 ON motcle_acte (acte_id);
CREATE TABLE nature_acte (id INT NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_38F2A57AA4D60759 ON nature_acte (libelle);
CREATE TABLE piece_jointe (id INT NOT NULL, fk_acte_id INT NOT NULL, objet VARCHAR(255) NOT NULL, nom_pdf VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_AB5111D4BC3AFBDF ON piece_jointe (nom_pdf);
CREATE INDEX IDX_AB5111D4574885EB ON piece_jointe (fk_acte_id);
CREATE TABLE service (id INT NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_E19D9AD2A4D60759 ON service (libelle);
CREATE TABLE type_action (id INT NOT NULL, libelle VARCHAR(63) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_641BE7AAA4D60759 ON type_action (libelle);
CREATE TABLE utilisateur (id INT NOT NULL, email VARCHAR(127) NOT NULL, roles JSON NOT NULL, password VARCHAR(255) NOT NULL, PRIMARY KEY(id));
CREATE UNIQUE INDEX UNIQ_1D1C63B3E7927C74 ON utilisateur (email);
ALTER TABLE acte ADD CONSTRAINT FK_9EC41326FD71BBD3 FOREIGN KEY (fk_etat_id) REFERENCES etat_acte (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE acte ADD CONSTRAINT FK_9EC413265A92F9DB FOREIGN KEY (fk_nature_id) REFERENCES nature_acte (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE acte ADD CONSTRAINT FK_9EC4132640218CB FOREIGN KEY (fk_matiere_id) REFERENCES matiere (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE acte ADD CONSTRAINT FK_9EC413261D326375 FOREIGN KEY (fk_service_id) REFERENCES service (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE action ADD CONSTRAINT FK_47CC8C923563B1BF FOREIGN KEY (fk_type_id) REFERENCES type_action (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE action ADD CONSTRAINT FK_47CC8C92574885EB FOREIGN KEY (fk_acte_id) REFERENCES acte (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE action ADD CONSTRAINT FK_47CC8C928E8608A6 FOREIGN KEY (fk_utilisateur_id) REFERENCES utilisateur (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE matiere ADD CONSTRAINT FK_9014574A67C9B117 FOREIGN KEY (fk_famille_id) REFERENCES famille_matiere (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE motcle_acte ADD CONSTRAINT FK_32EC2CF71D93C8D9 FOREIGN KEY (motcle_id) REFERENCES motcle (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE motcle_acte ADD CONSTRAINT FK_32EC2CF7A767B8C7 FOREIGN KEY (acte_id) REFERENCES acte (id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE piece_jointe ADD CONSTRAINT FK_AB5111D4574885EB FOREIGN KEY (fk_acte_id) REFERENCES acte (id) NOT DEFERRABLE INITIALLY IMMEDIATE;
INSERT INTO migration_versions (version, executed_at) VALUES ('20190704103231', CURRENT_TIMESTAMP);

-- Version 20190705122056
ALTER TABLE acte ALTER nom_pdf DROP NOT NULL;
INSERT INTO migration_versions (version, executed_at) VALUES ('20190705122056', CURRENT_TIMESTAMP);
